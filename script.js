const instructionsDiv=document.getElementById("instructions"),hiddenCardsContainer=document.getElementById("hidden-cards"),cardResponsiveRow1=document.getElementById("cardResponsiveRow1"),cardResponsiveRow2=document.getElementById("cardResponsiveRow2"),visibleCardsContainer=document.getElementById("visible-cards"),targetDisplay=document.getElementById("target-number"),timerDisplay=document.getElementById("timer"),checkBtn=document.getElementById("check"),resetBtn=document.getElementById("reset"),messageDisplay=document.getElementById("message"),expressionInput=document.getElementById("expression"),operators=document.getElementById("operators");let selectedHidden=[],targetNumber=null,timer=60,interval,usedNumbers=new Set;const sounds={flip:new Audio("flip.mp3"),correct:new Audio("correct.mp3"),incorrect:new Audio("incorrect.mp3"),timeUp:new Audio("timeup.mp3"),pocotiempo:new Audio("pocotiempo.mp3")};function pushNumber(e){expressionInput.value+=e.dataset.value,usedNumbers.add(e),e.classList.add("disabled")}function barajarDe0a10(){let e=[...Array(10).keys()];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function createHiddenCards(){cardResponsiveRow1.innerHTML="",cardResponsiveRow2.innerHTML="";barajarDe0a10().forEach((e=>{const t=document.createElement("div");t.className="card hidden",t.textContent=e,t.dataset.value=e,t.addEventListener("click",(()=>{selectedHidden.length<2&&!t.classList.contains("revealed")&&(t.classList.remove("hidden"),t.classList.add("revealed"),t.style.color="gray",selectedHidden.push(Number(t.dataset.value)),sounds.flip.play(),2===selectedHidden.length&&(targetNumber=10*selectedHidden[0]+selectedHidden[1],targetDisplay.textContent=`NÃºmero objetivo: ${targetNumber}`,startTimer()))})),cardResponsiveRow1.childElementCount==cardResponsiveRow2.childElementCount?cardResponsiveRow1.appendChild(t):cardResponsiveRow2.appendChild(t)})),hiddenCardsContainer.appendChild(cardResponsiveRow1)}function startTimer(){window.innerWidth<900&&(visibleCardsContainer.style.display="initial",operators.style.display="inherit",hiddenCardsContainer.style.display="none"),clearInterval(interval),timer=60,updateTimerStyle(),interval=setInterval((()=>{timer--,timerDisplay.textContent=`Tiempo: ${timer}`,updateTimerStyle(),timer<=3&&sounds.pocotiempo.play(),timer<=0&&(clearInterval(interval),messageDisplay.textContent="Â¡Tiempo agotado!",sounds.timeUp.play())}),1e3)}function updateTimerStyle(){timer<=20?(timerDisplay.style.backgroundColor="red",timerDisplay.style.color="white"):timer<=40?(timerDisplay.style.backgroundColor="yellow",timerDisplay.style.color="black"):timerDisplay.style.backgroundColor="green"}document.querySelectorAll(".operator").forEach((e=>{e.addEventListener("click",(()=>{expressionInput.value+=e.dataset.op,e.classList.add("disabled")}))})),instructionsDiv.addEventListener("click",(()=>{"none"===instructionsDiv.querySelector("ul").style.display||""===instructionsDiv.querySelector("ul").style.display?(document.getElementById("span1F783").setAttribute("hidden","hidden"),instructionsDiv.querySelector("ul").setAttribute("style","display:inline")):(document.getElementById("span1F783").removeAttribute("hidden"),instructionsDiv.querySelector("ul").setAttribute("style","display:none"))})),checkBtn.addEventListener("click",(()=>{const expr=expressionInput.value;try{if(!/^.*\*.*\+.*-.*$/.test(expr))return messageDisplay.textContent="Debes usar los operadores en orden: x + -",document.getElementById("usar-los-tres-operadores").className="incorrect",sounds.incorrect.play(),void setTimeout((()=>{document.getElementById("usar-los-tres-operadores").className="",messageDisplay.textContent="",messageDisplay.className="message-box"}),3e3);if(/(^|[^0-9])1\*|(\*)1([^0-9]|$)/.test(expr))return messageDisplay.textContent="ðŸš« No se permite multiplicar directamente por 1. Usa otros nÃºmeros.",messageDisplay.className="message-box incorrect",document.getElementById("multiplicar-por-1").className="incorrect",sounds.incorrect.play(),void setTimeout((()=>{document.getElementById("multiplicar-por-1").className="",messageDisplay.textContent="",messageDisplay.className="message-box"}),3e3);const result=eval(expr);if(result===targetNumber){messageDisplay.textContent="Â¡Correcto!",sounds.correct.play(),clearInterval(interval),confetti({particleCount:150,spread:70,origin:{y:.6}});const e=document.createElement("div");e.textContent="Â¡Ganaste!",e.classList.add("win-message"),document.body.appendChild(e),setTimeout((()=>{e.style.opacity=0,setTimeout((()=>e.remove()),500)}),3e3)}else messageDisplay.textContent="Incorrecto, intenta de nuevo.",sounds.incorrect.play()}catch{messageDisplay.textContent="ExpresiÃ³n invÃ¡lida."}})),resetBtn.addEventListener("click",(()=>{window.innerWidth<900&&(visibleCardsContainer.style.display="none",operators.style.display="none",hiddenCardsContainer.style.display="inherit"),clearInterval(interval),timer=60,timerDisplay.textContent=`Tiempo: ${timer}`,updateTimerStyle(),cardResponsiveRow1.style.display="none !important;";const e=document.querySelectorAll(".card, .disabled");Array.prototype.forEach.call(e,(function(e){e.classList.remove("disabled"),e.classList.add("visible")})),expressionInput.value="",messageDisplay.textContent="",targetDisplay.textContent="",selectedHidden=[],targetNumber=null,usedNumbers.clear(),document.querySelectorAll(".operator").forEach((e=>e.classList.remove("disabled"))),createHiddenCards(),createVisibleCards()})),expressionInput.addEventListener("input",(()=>{const e=expressionInput.value;usedNumbers.clear(),document.querySelectorAll("#visible-cards .card").forEach((e=>{e.classList.remove("disabled")})),document.querySelectorAll(".operator").forEach((e=>{e.classList.remove("disabled")}));for(let t=1;t<=9;t++)if(e.includes(t.toString())){usedNumbers.add(t);const e=document.querySelector(`#visible-cards .card[data-value="${t}"]`);e?.classList.add("disabled")}["x","+","-"].forEach((t=>{if(e.includes(t)){const e=document.querySelector(`.operator[data-op="${t}"]`);e?.classList.add("disabled")}}))})),createHiddenCards(),expressionInput.value="",window.innerWidth<900&&(visibleCardsContainer.style.display="none",operators.style.display="none");